version: 1.0
runtime: nodejs22
build:
  commands:
    build:
      # Install dependencies (including devDependencies for build)
      - npm ci --ignore-scripts
      # Build the TypeScript application
      - npm run build
      # Clean up devDependencies to reduce image size
      - npm prune --production
  env:
    # Build-time environment variables
    - name: NODE_ENV
      value: production
run:
  runtime-version: 22
  command: node dist/index.js
  network:
    port: 8080
    env: PORT
  env:
    # Runtime environment variables (these will be set in App Runner service configuration)
    - name: NODE_ENV
      value: production
    - name: PORT
      value: "8080"